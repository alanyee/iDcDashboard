<html>
<head>
  <title>dc.js scatter test</title>
  <!--d3-->
  <meta http-equiv="content-type" content="text/html; charset=UTF8"> 
  <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.js" charset="utf-8"></script>

  <!--crossfilter-->
  <script src="http://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.9/crossfilter.js" charset="utf-8"></script>

  <!--dc.js-->
  <script src="http://cdnjs.cloudflare.com/ajax/libs/dc/2.0.0-alpha.2/dc.js" charset="utf-8"></script>
  <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/dc/2.0.0-alpha.2/dc.css">

  <!--Define data and crossfilter stuff-->
  <script>
    var data = [
        { "date":"18-Sep-14", "open":192.79, "high":194.13, "low":192.71, "close":193.75, "volume":2963446 },
        { "date":"17-Sep-14", "open":193.22, "high":193.64, "low":192.30, "close":192.80, "volume":3214117 },
        { "date":"16-Sep-14", "open":191.25, "high":193.57, "low":190.82, "close":192.96, "volume":2561528 },
        { "date":"15-Sep-14", "open":191.42, "high":192.49, "low":190.58, "close":191.81, "volume":2457803 },
        { "date":"12-Sep-14", "open":191.47, "high":191.60, "low":190.57, "close":191.28, "volume":2900967 },
        { "date":"11-Sep-14", "open":191.08, "high":192.78, "low":190.12, "close":191.72, "volume":2299390 }, 
        { "date":"10-Sep-14", "open":190.12, "high":192.15, "low":190.10, "close":191.54, "volume":2765324 },
        { "date":"9-Sep-14", "open":190.34, "high":190.74, "low":189.78, "close":189.99, "volume":2403631 },
        { "date":"8-Sep-14", "open":190.75, "high":191.20, "low":189.51, "close":190.14, "volume":2525626 },
        { "date":"5-Sep-14", "open":190.53, "high":191.75, "low":190.09, "close":191.20, "volume":2261215 },
        { "date":"4-Sep-14", "open":191.69, "high":192.69, "low":190.06, "close":190.68, "volume":2868754 },
        { "date":"3-Sep-14", "open":192.39, "high":192.95, "low":191.86, "close":191.95, "volume":1824378 },
        { "date":"2-Sep-14", "open":192.68, "high":192.97, "low":190.93, "close":191.56, "volume":2679659 },
        { "date":"29-Aug-14", "open":192.28, "high":192.75, "low":191.14, "close":192.30, "volume":2911097 },
        { "date":"28-Aug-14", "open":191.47, "high":192.30, "low":190.66, "close":192.00, "volume":1503582 },
        { "date":"27-Aug-14", "open":193.03, "high":194.13, "low":191.56, "close":192.25, "volume":2190285 },
        { "date":"26-Aug-14", "open":191.02, "high":193.53, "low":191.02, "close":192.99, "volume":3175399 },
        { "date":"25-Aug-14", "open":191.39, "high":191.81, "low":190.71, "close":191.16, "volume":1726100 },
        { "date":"22-Aug-14", "open":190.77, "high":191.88, "low":190.29, "close":190.41, "volume":1940434 },
        { "date":"21-Aug-14", "open":190.90, "high":192.07, "low":190.50, "close":191.23, "volume":2497985 },
        { "date":"20-Aug-14", "open":189.86, "high":190.39, "low":189.25, "close":190.10, "volume":2177702 },
        { "date":"19-Aug-14", "open":190.04, "high":190.25, "low":189.36, "close":190.07, "volume":2040117 },
        { "date":"18-Aug-14", "open":188.10, "high":189.81, "low":187.76, "close":189.36, "volume":2420398 },
        { "date":"15-Aug-14", "open":187.85, "high":188.88, "low":186.79, "close":187.38, "volume":2815822 },
        { "date":"14-Aug-14", "open":187.57, "high":188.17, "low":186.93, "close":187.88, "volume":1929581 },
        { "date":"13-Aug-14", "open":188.00, "high":188.48, "low":187.37, "close":187.95, "volume":1797016 },
        { "date":"12-Aug-14", "open":187.45, "high":188.69, "low":186.81, "close":187.34, "volume":1858635 },
        { "date":"11-Aug-14", "open":187.81, "high":188.36, "low":186.28, "close":187.47, "volume":2527208 },
        { "date":"8-Aug-14", "open":184.40, "high":186.67, "low":183.58, "close":186.63, "volume":2781936 },
        { "date":"7-Aug-14", "open":186.64, "high":186.68, "low":183.58, "close":184.30, "volume":2708935 },
        { "date":"6-Aug-14", "open":185.36, "high":186.88, "low":184.44, "close":185.97, "volume":3847046 },
        { "date":"5-Aug-14", "open":188.75, "high":189.20, "low":186.44, "close":187.10, "volume":3307945 },
        { "date":"4-Aug-14", "open":189.35, "high":189.95, "low":188.60, "close":189.64, "volume":2125935 },
        { "date":"1-Aug-14", "open":190.50, "high":191.50, "low":188.86, "close":189.15, "volume":5181080 },
        { "date":"31-Jul-14", "open":192.84, "high":194.29, "low":191.54, "close":191.67, "volume":4208005 },
        { "date":"30-Jul-14", "open":195.20, "high":195.99, "low":192.90, "close":194.00, "volume":3945601 },
        { "date":"29-Jul-14", "open":195.30, "high":195.89, "low":194.54, "close":194.57, "volume":3264409 },
        { "date":"28-Jul-14", "open":194.30, "high":196.40, "low":193.65, "close":195.78, "volume":3242443 },
        { "date":"25-Jul-14", "open":195.30, "high":195.90, "low":193.79, "close":194.40, "volume":3376455 },
        { "date":"24-Jul-14", "open":193.95, "high":195.62, "low":193.75, "close":195.24, "volume":3612656 },
        { "date":"23-Jul-14", "open":194.11, "high":194.90, "low":193.57, "close":193.63, "volume":3584465 },
        { "date":"22-Jul-14", "open":191.59, "high":194.72, "low":191.56, "close":194.09, "volume":4853041 },
        { "date":"21-Jul-14", "open":191.30, "high":191.70, "low":189.25, "close":190.85, "volume":4154740 },
        { "date":"18-Jul-14", "open":191.96, "high":193.44, "low":190.00, "close":192.50, "volume":8169325 },
        { "date":"17-Jul-14", "open":192.36, "high":195.95, "low":192.00, "close":192.49, "volume":8872269 },
        { "date":"16-Jul-14", "open":192.24, "high":193.36, "low":190.76, "close":192.36, "volume":7815648 },
        { "date":"15-Jul-14", "open":189.54, "high":190.08, "low":188.21, "close":188.49, "volume":4873452 },
        { "date":"14-Jul-14", "open":188.55, "high":190.44, "low":188.53, "close":189.86, "volume":4502202 },
        { "date":"11-Jul-14", "open":187.73, "high":188.35, "low":186.70, "close":188.00, "volume":2403840 },
        { "date":"10-Jul-14", "open":186.44, "high":188.05, "low":186.21, "close":187.70, "volume":3177816 },
        { "date":"9-Jul-14", "open":187.68, "high":188.90, "low":186.89, "close":188.42, "volume":3309559 },
        { "date":"8-Jul-14", "open":187.65, "high":188.08, "low":186.37, "close":187.22, "volume":3135115 },
        { "date":"7-Jul-14", "open":187.61, "high":188.27, "low":187.44, "close":188.04, "volume":2958947 },
        { "date":"3-Jul-14", "open":188.39, "high":188.81, "low":187.35, "close":188.53, "volume":2422363 },
        { "date":"2-Jul-14", "open":186.34, "high":188.99, "low":186.17, "close":188.39, "volume":5097199 },
        { "date":"1-Jul-14", "open":181.70, "high":187.27, "low":181.70, "close":186.35, "volume":6644363 },
        { "date":"30-Jun-14", "open":181.33, "high":181.93, "low":180.26, "close":181.27, "volume":4228836 },
        { "date":"27-Jun-14", "open":179.77, "high":182.46, "low":179.66, "close":181.71, "volume":4575680 },
        { "date":"26-Jun-14", "open":180.87, "high":181.37, "low":179.27, "close":180.37, "volume":3258470 },
        { "date":"25-Jun-14", "open":180.25, "high":180.97, "low":180.06, "close":180.72, "volume":2763020 },
        { "date":"24-Jun-14", "open":181.50, "high":183.00, "low":180.65, "close":180.88, "volume":3875453 },
        { "date":"23-Jun-14", "open":181.92, "high":182.25, "low":181.00, "close":182.14, "volume":3231699 },
        { "date":"20-Jun-14", "open":182.59, "high":182.67, "low":181.40, "close":181.55, "volume":10686834 },
        { "date":"19-Jun-14", "open":184.12, "high":184.47, "low":182.36, "close":182.82, "volume":3551276 },
        { "date":"18-Jun-14", "open":182.04, "high":183.61, "low":181.79, "close":183.60, "volume":3935653 },
        { "date":"17-Jun-14", "open":181.90, "high":182.81, "low":181.56, "close":182.26, "volume":2460857 },
        { "date":"16-Jun-14", "open":182.40, "high":182.71, "low":181.24, "close":182.35, "volume":3556218 },
        { "date":"13-Jun-14", "open":182.00, "high":183.00, "low":181.52, "close":182.56, "volume":2778984 },
        { "date":"12-Jun-14", "open":182.48, "high":182.55, "low":180.91, "close":181.22, "volume":4425491 },
        { "date":"11-Jun-14", "open":183.61, "high":184.20, "low":182.01, "close":182.25, "volume":4065310 },
        { "date":"10-Jun-14", "open":186.20, "high":186.22, "low":183.82, "close":184.29, "volume":4157062 },
        { "date":"9-Jun-14", "open":186.22, "high":187.64, "low":185.96, "close":186.22, "volume":2728403 },
        { "date":"6-Jun-14", "open":186.47, "high":187.65, "low":185.90, "close":186.37, "volume":3296900 },
        { "date":"5-Jun-14", "open":184.66, "high":186.09, "low":183.92, "close":185.98, "volume":2861974 },
        { "date":"4-Jun-14", "open":184.71, "high":185.45, "low":184.20, "close":184.51, "volume":2376981 },
        { "date":"3-Jun-14", "open":185.55, "high":185.76, "low":184.12, "close":184.37, "volume":2517123 },
        { "date":"2-Jun-14", "open":184.76, "high":186.28, "low":184.67, "close":185.69, "volume":3204034 },
        { "date":"30-May-14", "open":183.38, "high":184.57, "low":182.49, "close":184.36, "volume":4620207 },
        { "date":"29-May-14", "open":183.64, "high":183.78, "low":182.33, "close":183.76, "volume":2759978 },
        { "date":"28-May-14", "open":184.48, "high":184.88, "low":182.94, "close":183.08, "volume":3724124 },
        { "date":"27-May-14", "open":184.80, "high":185.65, "low":183.93, "close":184.78, "volume":4794501 },
        { "date":"23-May-14", "open":185.84, "high":186.14, "low":185.31, "close":185.94, "volume":2563424 },
        { "date":"22-May-14", "open":186.45, "high":186.45, "low":185.03, "close":185.68, "volume":2218149 },
        { "date":"21-May-14", "open":185.85, "high":187.16, "low":184.95, "close":186.39, "volume":2988348 },
        { "date":"20-May-14", "open":186.25, "high":186.70, "low":184.70, "close":184.89, "volume":3032896 },
        { "date":"19-May-14", "open":186.61, "high":187.13, "low":186.04, "close":187.00, "volume":3270670 },
        { "date":"16-May-14", "open":186.27, "high":187.41, "low":185.93, "close":187.06, "volume":3949644 },
        { "date":"15-May-14", "open":189.07, "high":189.08, "low":186.18, "close":186.46, "volume":4202556 },
        { "date":"14-May-14", "open":191.91, "high":191.99, "low":188.17, "close":188.72, "volume":5255970 },
        { "date":"13-May-14", "open":192.79, "high":193.03, "low":191.76, "close":192.19, "volume":2226997 },
        { "date":"12-May-14", "open":191.12, "high":193.02, "low":190.94, "close":192.57, "volume":3778611 }
      ];
    
    var ndx = crossfilter(data); 
    var parseDate = d3.time.format("%d-%b-%y").parse;

    data.forEach(function(d) {
      d.date = parseDate(d.date);
    });

    var date_dim      = ndx.dimension(function(d) { return d.date; });
    var minDate       = date_dim.bottom(1)[0].date;
    var maxDate       = date_dim.top(1)[0].date;
    
    var line_group    = date_dim.group().reduceSum( function(d){  return d.high; });



</script>
</head>
<body>

  <!--Elements to render on-->
    <center>
      <h1>IBM Stock Prices</h1>
      <div id="chart-line"></div>
      <div id="chart-scatter"></div>
    </center>
    <table>
    <tr>
      <td> X Axis: </td>
      <td> <select id="xaxis" onchange="scatter_dim.dispose(); scatter_dim = makeScatterDim(); scatter_group = scatter_dim.group(); plot.dimension(scatter_dim).group(scatter_group); dc.renderAll();">
        <option value="open">Open</option>
        <option value="high">High</option>
        <option value="low">Low</option>
        <option value="close">Close</option>
        <option value="volume">Volume</option>
      </select> </td>
    </tr>
    <tr>
      <td> Y Axis: </td>
      <td> <select id="yaxis" onchange="scatter_dim.dispose(); scatter_dim = makeScatterDim(); scatter_group = scatter_dim.group(); plot.dimension(scatter_dim).group(scatter_group); dc.renderAll();">
      
        <option value="open">Open</option>
        <option value="high">High</option>
        <option value="low">Low</option>
        <option value="close">Close</option>
        <option value="volume">Volume</option>
      </select> </td>
    </tr>
  </table>
   

  <!--Script to render charts, must come after divs-->
  <script>
    var xselect = document.getElementById("xaxis");
    var yselect = document.getElementById("yaxis");

    function makeScatterDim() {
      return ndx.dimension(function(d) { 
        var xAxis = xselect.options[xselect.selectedIndex].value;
        var yAxis = yselect.options[yselect.selectedIndex].value;
        return eval("[d." + xAxis +" , d." + yAxis + "]"); }
        );
    }

    var scatter_dim   = makeScatterDim();
    var scatter_group = scatter_dim.group();

    var plot  = dc.scatterPlot("#chart-scatter");
    plot
      .width(400).height(400)
      .x(d3.scale.linear().domain([170,200]))
      .y(d3.scale.linear().domain([170,200]))
      .yAxisLabel("Y Axis")
      .xAxisLabel("X Axis")
      .dimension(scatter_dim)
      .group(scatter_group);

    var line  = dc.lineChart("#chart-line");
    line
      .width(800).height(400)
      .x(d3.time.scale().domain([minDate,maxDate]))
      .y(d3.scale.linear().domain([170,200]))
      .yAxisLabel("High Price")
      .xAxisLabel("Date")
      .dimension(date_dim)
      .group(line_group);

    dc.renderAll();

  </script>
</body>
</html>

